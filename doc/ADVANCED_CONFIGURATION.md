# 高级配置手册 (`ADVANCED_CONFIGURATION.md`)

## 1. 简介

`Tic-tac` 的行为可以通过一系列命令行参数进行精细控制。这些参数允许用户调整计算的精度、所包含的物理过程、输入/输出行为等。本手册详细解释了各项主要参数的含义和用法。

您可以通过运行 `./run -h` 或 `./run --help` 查看所有可用选项的简要说明。

## 2. 使用方法

有两种方式可以设置参数：

1.  **通过输入文件**:
    您可以创建一个文本文件（例如 `input.txt`），并在其中以 `key=value` 的格式指定参数，每行一个。然后通过 `./run input.txt` 来加载这些参数。

2.  **通过命令行**:
    直接在命令行中以 `key=value` 的形式追加参数。例如：`./run Np_WP=60 Nq_WP=60`。

**注意**: 程序会按顺序处理参数。如果在多个地方（例如，在文件和命令行中）都设置了同一个参数，程序将采用最后读取到的值。

## 3. 参数详解

### 3.1 基空间与离散化参数

这些参数控制了计算所使用的希尔伯特空间的大小和精度，对计算资源（内存和时间）影响最大。

-   `two_J_3N_max`: (整数)
    设置三核子 (3N) 系统总角动量的最大值（的2倍）。例如，`two_J_3N_max=3` 表示计算将包含 $J_{3N}=1/2$ 和 $J_{3N}=3/2$ 的通道。

-   `J_2N_max`: (整数)
    设置任意核子对 (2N) 的总角动量的最大值。这是截断分波展开的主要参数之一。增加此值会显著增大基空间。

-   `Np_WP`, `Nq_WP`: (整数)
    分别设置雅可比动量 $p$ 和 $q$ 的波包（Wave Packets）数量。这决定了动量轴的离散化程度。值越大，精度越高，计算量也越大。默认值为 50。

-   `Np_per_WP`, `Nq_per_WP`: (整数)
    设置每个波包内部用于数值积分的求积点（Gauss-Legendre 点）数量。这影响了二体相互作用矩阵元的计算精度。默认值为 8。

-   `Nphi`, `Nx`: (整数)
    在计算置换矩阵 `P123` 时，用于角度积分的求积点数量。`Nphi` 用于方位角积分，`Nx` 用于 $\cos(\theta)$ 积分。默认值均为 48。

-   `p_grid_type`, `q_grid_type`: (字符串)
    设置动量波包边界的分布类型。目前主要支持 `chebyshev` 分布，这种分布在低动量区更密集，符合物理需求。

-   `chebyshev_t`, `chebyshev_s`: (浮点数)
    当使用 `chebyshev` 网格时，这两个参数分别控制分布的稀疏度（`t`）和能量尺度（`s`, 单位 MeV）。

### 3.2 计算流程控制参数

这些参数用于控制程序的执行流程，例如跳过某些计算步骤或启用特定的计算模式。

-   `calculate_and_store_P123`: (布尔值: `true`/`false`)
    是否计算并存储置换矩阵 `P123`。由于此计算非常耗时，通常在第一次运行时设为 `true`，之后设为 `false` 以从磁盘加载已存的结果。

-   `solve_faddeev`: (布尔值: `true`/`false`)
    是否求解 Faddeev 方程。如果只想进行基空间构建或 `P123` 计算，可以将其设为 `false`。

-   `include_breakup_channels`: (布尔值: `true`/`false`)
    是否计算破裂反应（即三个核子都处于自由态）的散射振幅。

-   `P123_recovery`: (布尔值: `true`/`false`)
    P123 恢复模式。如果 `P123` 的计算意外中断，设为 `true` 可以尝试从已生成的临时文件中恢复部分进度。

-   `production_run`: (布尔值: `true`/`false`)
    生产运行模式。设为 `true` 时，会关闭一些用于调试的检查，可能会略微提升性能。

-   `solve_dense`: (布尔值: `true`/`false`)
    使用 LAPACK 直接求解（而非迭代法）Faddeev 方程。**仅适用于非常小的基空间**，主要用于调试目的。

### 3.3 物理模型参数

这些参数与计算中使用的物理模型直接相关。

-   `potential_model`: (字符串)
    选择使用的二体相互作用势模型。可用选项包括：
    - `LO_internal`: 内置的手征势（Leading Order）。
    - `N2LOopt`: 优化的 N2LO 手征势。
    - `Idaho_N3LO`: Idaho N3LO 手征势。
    - `nijmegen`: 奈梅亨势。
    - `malfliet_tjon`: 一个简化的唯象势模型。

-   `tensor_force`: (布尔值: `true`/`false`)
    是否在计算中包含张量力。张量力是核力的一个关键组成部分，通常应设为 `true`。

-   `isospin_breaking_1S0`: (布尔值: `true`/`false`)
    是否考虑 `1S0` 通道中的同位旋破缺效应。

### 3.4 输入/输出与并行计算参数

-   `energy_input_file`: (字符串)
    指定包含入射能量列表的文件名。默认为 `lab_energies.txt`。

-   `P123_folder`: (字符串)
    指定读取和写入 `P123` 矩阵文件的目录。默认为 `Output`。

-   `output_folder`: (字符串)
    指定所有其他输出文件的根目录。

-   `parallel_run`: (布尔值: `true`/`false`)
    是否启用并行计算模式。此处的并行指的是按 3N 通道（`J_3N`, `Parity`）进行任务划分，通常用于在计算集群上提交多个作业，每个作业负责一个通道。

-   `channel_idx`: (整数)
    当 `parallel_run=true` 时，此参数指定当前作业需要计算的 3N 通道的索引（从0开始）。

-   `P123_omp_num_threads`: (整数)
    在计算 `P123` 矩阵时，使用的 OpenMP 线程数。这允许在多核 CPU 上进行共享内存并行计算，以加速 `P123` 的生成。
